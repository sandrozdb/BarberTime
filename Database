CREATE DATABASE IF NOT EXISTS sistema_barbearia;
USE sistema_barbearia;

-- Tabela: Usuario
CREATE TABLE Usuario (
    id_usuario INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    senha VARCHAR(100) NOT NULL,
    cpf_cnpj VARCHAR(20) NOT NULL UNIQUE,
    tipo ENUM('cliente', 'profissional') NOT NULL,
    nivel_acesso ENUM('dono', 'barbeiro') DEFAULT NULL,
    telefone VARCHAR(20)
);

-- Tabela: Barbearia
CREATE TABLE Barbearia (
    id_barbearia INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    cnpj VARCHAR(20) NOT NULL UNIQUE,
    endereco VARCHAR(200),
    telefone VARCHAR(20),
    dono_id INT,
    FOREIGN KEY (dono_id) REFERENCES Usuario(id_usuario)
);

-- Tabela intermediária: Barbeiros_Barbearias
CREATE TABLE Barbeiros_Barbearias (
    id INT AUTO_INCREMENT PRIMARY KEY,
    barbeiro_id INT NOT NULL,
    barbearia_id INT NOT NULL,
    FOREIGN KEY (barbeiro_id) REFERENCES Usuario(id_usuario),
    FOREIGN KEY (barbearia_id) REFERENCES Barbearia(id_barbearia)
);

-- Tabela: Servico
CREATE TABLE Servico (
    id_servico INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(50) NOT NULL
);

-- Tabela: Barbearia_Servicos (com preço)
CREATE TABLE Barbearia_Servicos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    barbearia_id INT NOT NULL,
    servico_id INT NOT NULL,
    preco DECIMAL(6,2) NOT NULL,
    FOREIGN KEY (barbearia_id) REFERENCES Barbearia(id_barbearia),
    FOREIGN KEY (servico_id) REFERENCES Servico(id_servico)
);

-- Tabela: Agendamento
CREATE TABLE Agendamento (
    id_agendamento INT AUTO_INCREMENT PRIMARY KEY,
    cliente_id INT NOT NULL,
    barbeiro_id INT NOT NULL,
    barbearia_id INT NOT NULL,
    data DATE NOT NULL,
    hora TIME NOT NULL,
    status ENUM('confirmado', 'cancelado', 'concluido') DEFAULT 'confirmado',
    FOREIGN KEY (cliente_id) REFERENCES Usuario(id_usuario),
    FOREIGN KEY (barbeiro_id) REFERENCES Usuario(id_usuario),
    FOREIGN KEY (barbearia_id) REFERENCES Barbearia(id_barbearia)
);

-- Tabela: Agendamento_Servicos
CREATE TABLE Agendamento_Servicos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    agendamento_id INT NOT NULL,
    servico_id INT NOT NULL,
    FOREIGN KEY (agendamento_id) REFERENCES Agendamento(id_agendamento),
    FOREIGN KEY (servico_id) REFERENCES Servico(id_servico)
);
